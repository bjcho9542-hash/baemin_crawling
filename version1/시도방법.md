# 배달의민족 크롤링 시도 방법 정리

## 최종 결과: ✅ 성공 (uiautomator2 방식)

---

## 방법 1: API 패킷 분석 (mitmproxy)

### 시도 내용
- mitmproxy 설치 및 실행 (mitmweb)
- 에뮬레이터 프록시 설정 (10.0.2.2:8080)
- mitmproxy 인증서 설치

### 결과: ❌ 실패

### 실패 이유
- **SSL Pinning**: 배달의민족 앱은 SSL Pinning을 적용하여 mitmproxy 인증서를 거부
- **에러 메시지**: `Client TLS handshake failed`
- Google 트래픽만 캡처되고 배민 API 트래픽은 전혀 잡히지 않음

### 해결 방법 (시도 안함)
- Frida를 사용한 SSL Pinning 우회 가능하나 복잡하고 시간 소요

---

## 방법 2: 웹 크롤링 (requests, selenium)

### 시도 내용
- 배달의민족 웹사이트 존재 여부 확인

### 결과: ❌ 불가능

### 실패 이유
- 배달의민족은 **앱 전용 서비스**
- 주문 가능한 웹 버전이 없음
- 웹사이트는 앱 다운로드 유도 페이지만 존재

---

## 방법 3: uiautomator2 (UI 자동화) ✅ 성공

### 시도 내용
1. Python + uiautomator2 설치
2. ADB로 에뮬레이터 연결
3. 배민 앱 UI 요소 분석 (dump_hierarchy)
4. 자동화 스크립트 작성

### 결과: ✅ 성공

### 성공 과정
1. **에뮬레이터 연결**
   ```python
   import uiautomator2 as u2
   d = u2.connect()
   ```

2. **카테고리 선택** (치킨, 피자 등)
   ```python
   d(description='치킨').click()
   ```

3. **가게 클릭**
   - 클릭 가능한 요소 중 bounds 분석으로 가게 식별
   - 좌표로 클릭

4. **가게정보 페이지 접근**
   ```python
   d(textContains='정보').click()
   ```

5. **정보 추출**
   - dump_hierarchy()로 UI 덤프
   - 정규식으로 텍스트 추출
   - 상호명, 주소, 전화번호, 운영시간 등 파싱

### 추출 가능한 정보
| 항목 | 예시 |
|------|------|
| 상호명 | (주)모스버거코리아 센트럴점 |
| 주소 | 서울특별시 서초구 신반포로 176 1층 111-2호 |
| 전화번호 | 050-6256-8387 |
| 운영시간 | 매일 - 오전 9:00 ~ 오후 9:00 |
| 휴무일 | 연중무휴 |

### 주의사항
- 가게 상세 페이지가 **WebView**로 렌더링되는 경우가 있음
- 하지만 WebView 내부 텍스트 요소도 dump_hierarchy()로 접근 가능 (현재 버전)
- 앱 버전 업데이트 시 UI 구조 변경 가능성 있음

---

## 방법 4: Appium + ChromeDriver

### 시도 여부: ⏭️ 건너뜀

### 이유
- uiautomator2로 이미 성공했기 때문에 불필요
- Appium은 설정이 더 복잡함 (Node.js, Appium Server 등)
- WebView 내부 접근이 필요할 경우에만 고려

---

## 방법 5: Frida SSL Pinning 우회

### 시도 여부: ⏭️ 건너뜀

### 이유
- uiautomator2로 충분히 정보 추출 가능
- Frida는 루팅된 기기 또는 특수 설정 필요
- 복잡도가 높고 배민 앱 보안 업데이트에 취약

---

## 방법 6: OCR (Tesseract/EasyOCR)

### 시도 여부: ⏭️ 건너뜀

### 이유
- dump_hierarchy()로 텍스트 직접 추출 가능
- OCR은 정확도가 낮고 처리 속도가 느림
- 한글 인식률 이슈 있음

---

## 최종 권장 방법

### 환경 설정
```bash
# Python 패키지 설치
pip install uiautomator2

# ADB 경로 설정 (Windows)
set ANDROID_HOME=C:\Android\Sdk

# 에뮬레이터 시작
emulator -avd Medium_Phone_API_36.1

# ADB 연결 확인
adb devices
```

### 크롤링 실행
```bash
# 현재 열린 가게 정보 추출
python baemin_store_crawler.py

# 카테고리별 크롤링 (치킨 5개)
python baemin_store_crawler.py category 치킨 5
```

### 출력 결과
```json
{
  "store_name": "모스버거 센트럴시티점",
  "business_name": "(주)모스버거코리아 센트럴점",
  "address": "서울특별시 서초구 신반포로 176 1층 111-2호",
  "phone": "050-6256-8387",
  "hours": "매일 - 오전 9:00 ~ 오후 9:00",
  "closed_days": "연중무휴",
  "crawled_at": "2025-12-07T00:30:00"
}
```

---

## 한계점 및 주의사항

1. **속도**: UI 자동화는 API 직접 호출보다 느림 (가게당 5~10초)
2. **안정성**: 앱 UI 변경 시 스크립트 수정 필요
3. **대량 크롤링**: 배민 이용약관 위반 가능성, IP 차단 위험
4. **인증**: 로그인 필요한 정보는 추가 처리 필요

---

## 파일 목록

| 파일명 | 설명 |
|--------|------|
| `baemin_store_crawler.py` | 최종 크롤링 스크립트 |
| `baemin_crawler.py` | 테스트용 초기 스크립트 |
| `baemin_full_crawler.py` | 개발 중간 버전 |
| `crawled_stores.json` | 크롤링 결과 저장 파일 |
| `시도방법.md` | 이 문서 |
